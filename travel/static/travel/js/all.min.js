"use strict";function TravelAppConfig(e,r,n){e.defaults.stripTrailingSlashes=!1,r.defaults.xsrfCookieName="csrftoken",r.defaults.xsrfHeaderName="X-CSRFToken",n.when("/rides/:pk",{templateUrl:"/static/travel/templates/ride_details.html",controller:"rideDetailsController"}).when("/create/ride/:direction",{templateUrl:"/static/travel/templates/manage_ride.html",controller:"rideDetailsController"}).otherwise({redirectTo:"/rides",templateUrl:"/static/travel/templates/rides.html"})}function Dialog(e){function r(r,n){e.show({controller:"passengerJoinController",templateUrl:"/static/travel/templates/passenger_join.html",parent:angular.element(document.body),targetEvent:r,locals:{passengerModel:n},clickOutsideToClose:!0,fullscreen:!1})}function n(r){e.show(e.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Sikertelen tranzakcio!").textContent(r).ok("OK"))}function t(r){e.show(e.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(r).ok("OK"))}function o(r,n,t){var o=e.confirm().title(n).targetEvent(r).ok("Igen").cancel("Megse");e.show(o).then(t)}return{showPassengerJoin:r,showSuccess:t,showError:n,showConfirm:o}}function DriverObject(e,r,n,t){var o={model:null,add:function(){var r=this;t.save(r.model,function(n){r.model=n,e.$emit("DRIVER_ADDED",n)},function(e){n.showError(e)})},showModify:function(){r.url("/create/ride/"+(this.model.is_return?"back":"there"))},modify:function(){t.update({pk:this.model.pk},this.model,function(e){n.showSuccess("Jarmu reszletek sikeresen frissitve!")},function(e){n.showError(e)})},remove:function(){var r=this;t.remove({pk:r.model.pk},function(n){var t=angular.copy(r.model);r.model=null,e.$emit("DRIVER_DELETED",t)},function(e){n.showError(e)})},getRide:function(){return this.model}};return{driver:o}}function ManageRideController(e,r,n,t,o,i,l,a){function s(){n.url("/rides")}function u(){if(!("direction"in t))throw new Error("Direction not specified");return c(t.direction)}function c(e){var r;return r="there"===e?a.getDriverThere():a.getDriverBack(),d(r,e)}function d(e,r){return null==e.model&&(e.model={is_return:"there"!==r}),e}function g(){v()&&i.getPassengers({pk:_.driver.model.pk},function(e){_.passengers=e})}function v(){return null!=_.driver.model.pk}function m(){v()&&(P=!0)}function f(e){P?o.showConfirm(e,"Biztos vagy benne, hogy frissiteni akarod a jarmu tulajdonsagait?",p):o.showConfirm(e,"Biztos vagy benne, hogy letre akarod hozni a jarmuvet?",h)}function p(){_.driver.modify()}function h(){_.driver.add()}function D(e){o.showConfirm(e,"Biztos vagy benne, hogy torolni akarod a jarmuvet?",E)}function E(){_.driver.remove()}function T(e){o.showConfirm(e,"Biztos vagy benne, hogy torolni szeretned ezt az utast?",k)}function k(){for(var e=C(),r=0;r<e.length;r++){var n=e[r];l.remove({pk:n.pk},function(){$(n)})}}function C(){for(var e=[],r=0;r<_.passengers.length;r++)_.passengers[r].selected&&e.push(_.passengers[r]);return e}function $(e){_.passengers.splice(R(e),1)}function R(e){for(var r=0;r<_.passengers.length;r++)if(_.passengers[r].pk===e.pk)return r}var _=this;_.driver=null,_.passengers=[],_.showDriverSaveDialog=f,_.showDriverDeleteDialog=D,_.showPassengerDeleteDialog=T,_.isDriverExists=v,e.$on("DATETIME_CHANGED",function(e,r){_.driver.model.start_time=r.datetime}),r.$on("DRIVER_ADDED",s),r.$on("DRIVER_DELETED",s);var P=!1,w=function(){_.driver=u(),g(),m()};w()}function PassengerJoinController(e,r,n,t){e.passenger=t,e.joinRide=function(){r.hide(),null==e.passenger.pk?o():l()};var o=function(){i().add(e.passenger)},i=function(){return t.ride.is_return?n.getPassengerBack():n.getPassengerThere()},l=function(){i().modify(e.passenger)}}function PassengerObject(e,r,n){var t={model:null,showAdd:function(e,n){r.showPassengerJoin(e,{ride:n})},add:function(t){var o=t.ride,i=this;t.ride=o.pk,n.save(t,function(r){r=r.toJSON(),r.ride=o,i.model=r,e.$emit("PASSENGER_ADDED",r)},function(e){r.showError(e)})},showModify:function(e){r.showPassengerJoin(e,this.model)},modify:function(e){var t=angular.copy(this.model);t.ride=t.ride.pk,n.update({pk:this.model.pk},t,function(e){r.showSuccess("Utas reszletek sikeresen frissitve!")},function(e){r.showError(e)})},remove:function(){var r=this;n.remove({pk:r.model.pk},function(){var n=angular.copy(r.model);r.model=null,e.$emit("PASSENGER_DELETED",n)})},getRide:function(){return this.model.ride}};return{passenger:t}}function Passenger(e){return e("/rest/1/passengers/:pk/",null,{update:{method:"PUT",url:"/rest/1/passengers/:pk/",isArray:!1}})}function RidesDetailController(e,r){var n=this;n.ride=null,n.passengers=[];var t=function(){o()},o=function(){if("pk"in e){var r=e.pk;i(r),l(r)}},i=function(e){r.get({pk:e},function(e){n.ride=e,n.shouldUpdateOnSave=!0})},l=function(e){r.getPassengers({pk:e},function(e){n.passengers=e})};t()}function RideElementController(e,r,n){var t=this;t.ride=null,t.isJoinable=!1,t.showPassengerJoin=null;var o=function(){t.ride=r.ride,a(),t.showPassengerJoin=i,e.$on("PASSENGER_ADDED",a),e.$on("PASSENGER_DELETED",a),e.$on("DRIVER_ADDED",a),e.$on("DRIVER_DELETED",a)},i=function(e){l().passenger.showAdd(e,t.ride)},l=function(){return t.ride.is_return?n.getTravelBack():n.getTravelThere()},a=function(){t.isJoinable=l().isEmpty()&&0!=t.ride.num_of_free_seats};o()}function Ride(e){return e("/rest/1/rides/:pk/",null,{getPassengers:{method:"GET",url:"/rest/1/rides/:pk/passengers/",isArray:!0},update:{method:"PUT",url:"/rest/1/rides/:pk/",isArray:!1}})}function RidesController(e,r,n,t){var o=this;o.travel=t,o.there=[],o.back=[];var i=function(){v(),e.showPassengerJoin=l,r.$on("PASSENGER_DELETED",c),r.$on("PASSENGER_ADDED",a)},l=function(e,r){t.showManagePassengerDialog(e,r)},a=function(e,r){s(r)},s=function(e){var r=u(e.ride.pk);r.num_of_free_seats--},u=function(e){for(var r=0;r<g.length;r++)if(g[r].pk==e)return g[r]},c=function(e,r){d(r)},d=function(e){var r=u(e.ride.pk);r.num_of_free_seats++},g=[],v=function(){n.query(function(e){g=e,o.there=m(),o.back=f()})},m=function(){return g.filter(function(e){return!e.is_return})},f=function(){return g.filter(function(e){return e.is_return})};i()}function TimePickerElementController(e){var r=this;e.vm=r,r.time={hour:"00",min:"00",getHours:function(){for(var e=[],r=0;r<24;r++)e.push(a(r));return e},getMinutes:function(){for(var e=[],r=0;r<60;r++)e.push(a(r));return e},getTime:function(){return this.hour+":"+this.min}},r.date=new Date,r.getDateTime=null;var n=function(){o(),r.getDateTime=l};e.$watch("vm.time.hour",function(){t()},!0),e.$watch("vm.time.min",function(){t()},!0),e.$watch("vm.date",function(){t()},!0);var t=function(){e.$emit("DATETIME_CHANGED",{id:1,datetime:r.getDateTime()})},o=function(){"datetime"in e&&null!=e.datetime&&i(e.datetime)},i=function(e){var n=new Date(e),t=n.getUTCFullYear(),o=n.getUTCMonth(),i=n.getUTCDate(),l=n.getUTCHours(),a=n.getUTCMinutes();r.date=new Date(Date.UTC(t,o,i)),r.time.hour=l,r.time.min=a},l=function(){return r.date.getUTCFullYear()+"-"+a(r.date.getUTCMonth()+1)+"-"+a(r.date.getUTCDate())+"T"+r.time.getTime()},a=function(e){return e<10?"0"+e.toString():e.toString()};n()}function TravelElementController(e,r,n,t){var o=this;o.object=null,o.ride=null,o.remove=null,o.modify=null;var i=function(){var n=f(r.direction);o.object=p(n),o.ride=o.object.getRide(),o.remove=d,o.modify=m,e.$on("PASSENGER_DELETED",a),e.$on("PASSENGER_ADDED",l),e.$on("DRIVER_DELETED",c)},l=function(){i()},a=function(e,r){null!=o.ride&&s(o.ride,r.ride)&&u()},s=function(e,r){return e.is_return===r.is_return},u=function(){o.object.model=null,o.ride=null},c=function(e,r){null!=o.ride&&s(o.ride,r)&&u()},d=function(e){var t=null;t=f(r.direction).isDriving()?g(e,"Biztos vagy benne, hogy torolni szeretned a jarmuved?"):g(e,"Biztos vagy benne, hogy torolni szeretned a magad az utaslistarol?"),n.show(t).then(v)},g=function(e,r){return n.confirm().title(r).targetEvent(e).ok("Igen").cancel("Megse")},v=function(){o.object.remove()},m=function(e){o.object.showModify(e)},f=function(e){return"there"===e?t.getTravelThere():"back"===e?t.getTravelBack():void 0},p=function(e){return e.isDriving()?e.driver:e.passenger};i()}function TravelManager(e,r){function n(e,r){r.is_return?f.passenger.showAdd(e,r):m.passenger.showAdd(e,r)}function t(e){e.ride.is_return?(f.passenger.model=e,f.driver.model=null):(m.passenger.model=e,m.driver.model=null)}function o(e){e.is_return?(f.driver.model=e,f.passenger.model=null):(m.driver.model=e,m.passenger.model=null)}function i(){return m}function l(){return f}function a(e){var r=e.getObject();return null===r?null:r.model}function s(){return a(m)}function u(){return a(f)}function c(){return m.driver}function d(){return f.driver}function g(){return m.passenger}function v(){return f.passenger}var m=angular.copy(r.travel),f=angular.copy(r.travel);return{getPassengerThere:g,getPassengerBack:v,getDriverThere:c,getDriverBack:d,getTravelThere:i,getTravelBack:l,getModelThere:s,getModelBack:u,addPassenger:t,addDriver:o,showManagePassengerDialog:n}}function TravelUser(e){return e("/rest/1/travel_users/:pk",null,{getMe:{method:"GET",url:"/rest/1/travel_users/me/",isArray:!1}})}function TravelController(e,r){var n=this;n.me=null,n.there=r.getTravelThere(),n.back=r.getTravelBack();var t=function(){e.getMe(o)},o=function(e){n.me=e,i()},i=function(){for(var e=0;e<n.me.driven_rides.length;e++){var t=n.me.driven_rides[e];r.addDriver(t)}for(var e=0;e<n.me.passenger_of_rides.length;e++){var o=n.me.passenger_of_rides[e];r.addPassenger(o)}};t()}function Travel(e,r,n){var t={passenger:angular.copy(r.passenger),driver:angular.copy(n.driver),isDriving:function(){return null==this.passenger.model},isEmpty:function(){return this.isDriving()?null==this.driver.model:null==this.passenger.model},getObject:function(){return this.isEmpty()?null:this.isDriving()?this.driver:this.passenger}};return{travel:t}}angular.module("travelApp",["ngResource","ngRoute","ngMaterial","travelServices"]).config(TravelAppConfig),angular.module("travelServices",["ngResource"]),angular.module("travelServices").factory("Dialog",Dialog),Dialog.$inject=["$mdDialog"],angular.module("travelServices").factory("DriverObject",DriverObject),DriverObject.$inject=["$rootScope","$location","Dialog","Ride"],angular.module("travelApp").controller("manageRideController",ManageRideController),ManageRideController.$inject=["$scope","$rootScope","$location","$routeParams","Dialog","Ride","Passenger","TravelManager"],angular.module("travelApp").controller("passengerJoinController",PassengerJoinController),PassengerJoinController.$inject=["$scope","$mdDialog","TravelManager","passengerModel"],angular.module("travelServices").factory("PassengerObject",PassengerObject),PassengerObject.$inject=["$rootScope","Dialog","Passenger"],angular.module("travelServices").factory("Passenger",Passenger),Passenger.$inject=["$resource"],angular.module("travelApp").controller("rideDetailsController",RidesDetailController),RidesDetailController.$inject=["$routeParams","Ride"],angular.module("travelApp").controller("rideElementController",RideElementController),RideElementController.$inject=["$rootScope","$scope","TravelManager"],angular.module("travelApp").directive("rideElement",function(){return{restrict:"E",templateUrl:"/static/travel/templates/ride_element.html",scope:{ride:"="},controller:RideElementController,controllerAs:"element"}}),angular.module("travelServices").factory("Ride",Ride),Ride.$inject=["$resource"],angular.module("travelApp").controller("ridesController",RidesController),RidesController.$inject=["$scope","$rootScope","Ride","TravelManager"],angular.module("travelApp").controller("timepickerElementController",TimePickerElementController),TimePickerElementController.$inject=["$scope"],angular.module("travelApp").directive("timepickerElement",function(){return{restrict:"E",templateUrl:"/static/travel/templates/timepicker_element.html",scope:{datetime:"=",id:"="},controller:TimePickerElementController,controllerAs:"timepicker"}}),angular.module("travelApp").controller("travelElementController",TravelElementController),TravelElementController.$inject=["$rootScope","$scope","$mdDialog","TravelManager"],angular.module("travelApp").directive("travelElement",function(){return{restrict:"E",templateUrl:"/static/travel/templates/travel_element.html",scope:{direction:"="},controller:TravelElementController,controllerAs:"element"}}),angular.module("travelServices").factory("TravelManager",["$mdDialog","Travel",TravelManager]),TravelManager.$inject=["$mdDialog","Travel"],angular.module("travelServices").factory("TravelUser",TravelUser),TravelUser.$inject=["$resource"],angular.module("travelApp").controller("travelController",TravelController),TravelController.$inject=["TravelUser","TravelManager"],angular.module("travelServices").factory("Travel",["$rootScope","PassengerObject","DriverObject",Travel]),Travel.$inject=["$rootScope","PassengerObject","DriverObject"];